<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Plato Network</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin:0;
  background:#fff;
  font-family: system-ui, sans-serif;
}
#app {
  padding:24px;
  max-width:600px;
}
.box {
  border:1px solid #000;
  padding:16px;
  margin-bottom:16px;
}
button {
  padding:10px 14px;
  border:1px solid #000;
  background:#fff;
  cursor:pointer;
}
button:disabled {
  opacity:0.4;
  cursor:default;
}
</style>
</head>
<body>

<div id="app">
  <div class="box" id="wallet">wallet: connecting...</div>
  <div class="box" id="state"></div>
  <div class="box" id="action"></div>
</div>

<script>
(async () => {

  /* ---------- Wallet ---------- */
  let user = "anonymous";
  if (window.ethereum) {
    try {
      const acc = await ethereum.request({ method: "eth_requestAccounts" });
      if (acc.length) user = acc[0];
    } catch {}
  }
  document.getElementById("wallet").textContent = "wallet: " + user;

  const KEY = "plato_state_" + user;

  /* ---------- State ---------- */
  let state = JSON.parse(localStorage.getItem(KEY)) || {
    status: "NOT_JOINED",
    joinedAt: null
  };

  function save() {
    localStorage.setItem(KEY, JSON.stringify(state));
  }

  /* ---------- UI ---------- */
  function render() {
    const stateBox = document.getElementById("state");
    const actionBox = document.getElementById("action");
    actionBox.innerHTML = "";

    if (state.status === "NOT_JOINED") {
      stateBox.textContent = "status: not joined";
      const btn = document.createElement("button");
      btn.textContent = "Join Plato Network";
      btn.onclick = () => {
        state.status = "ACTIVE";
        state.joinedAt = Date.now();
        save();
        render();
      };
      actionBox.appendChild(btn);
    }

    if (state.status === "ACTIVE") {
      const elapsed = Math.floor((Date.now() - state.joinedAt) / 1000);
      stateBox.textContent =
        "status: active (" + elapsed + " sec elapsed)";
      const btn = document.createElement("button");
      btn.textContent = "Exit (after 30s)";
      btn.disabled = elapsed < 30;
      btn.onclick = () => {
        state.status = "EXITED";
        save();
        render();
      };
      actionBox.appendChild(btn);
    }

    if (state.status === "EXITED") {
      stateBox.textContent = "status: exited (cannot rejoin)";
      actionBox.textContent = "no further actions available";
    }
  }

  setInterval(render, 1000);
  render();

})();
</script>

</body>
</html>
